#!/bin/sh

LLVMCLANG_VERSION=18.1.6

curl -Ls https://github.com/opencor/llvm-project/archive/refs/tags/llvmorg-$LLVMCLANG_VERSION.zip -o llvm-project-llvmorg-$LLVMCLANG_VERSION.zip
unzip -qq llvm-project-llvmorg-$LLVMCLANG_VERSION.zip
\rm llvm-project-llvmorg-$LLVMCLANG_VERSION.zip

cd llvm-project-llvmorg-$LLVMCLANG_VERSION

cmake -G Ninja -S ./llvm -B build -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS=clang
cmake --build build -t llvm-tblgen clang-tblgen

if [ "$1" = "true" ]; then
    EXTENSION=.exe
fi

export DLLVMCLANG_LLVM_TABLEGEN=-DLLVMCLANG_LLVM_TABLEGEN=$PWD/build/bin/llvm-tblgen$EXTENSION
export DLLVMCLANG_CLANG_TABLEGEN=-DLLVMCLANG_CLANG_TABLEGEN=$PWD/build/bin/clang-tblgen$EXTENSION
